<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IronClad ¬∑ Billing</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">
<link rel="manifest" href="manifest.json">
</head>
<body>

<div class="bg">
  <div class="orb o1"></div>
  <div class="orb o2"></div>
  <div class="orb o3"></div>
</div>

<header>
  <div class="logo">
    <div class="logo-icon">üîß</div>
    IronClad <span style="color:var(--gold);font-weight:300;margin-left:4px;">Hardware</span>
  </div>
  <div class="chips">
    <div class="chip" id="clk"></div>
    <div class="chip">ADMIN</div>
    <div class="chip">Reg #01</div>
    <div class="nav-inv-card">
      <div>
        <div class="nav-inv-num" id="hdrInv">INV-0001</div>
        <div class="nav-inv-date" id="hdrDate"></div>
      </div>
      <div class="nav-cust-block">
        <div class="nav-cust-name" id="hdrCustName">Walk-in Customer</div>
        <div class="nav-cust-type" id="hdrCustType">Retail</div>
      </div>
    </div>
  </div>
</header>

<main>
  <!-- ‚ïê‚ïê LEFT ‚ïê‚ïê -->
  <div class="lp">

    <!-- Tabs -->
    <div class="card" style="flex:1;display:flex;flex-direction:column;gap:.75rem;min-height:0;">
      <div class="tabs">
        <button class="tab-btn active" onclick="tab('catalog',this)">Catalog</button>
        <button class="tab-btn" onclick="tab('barcode',this)">SKU Entry</button>
        <button class="tab-btn" onclick="tab('history',this)">History</button>
      </div>

      <!-- Catalog -->
      <div id="tp-catalog" class="tp active">
        <div class="sw"><span class="si">üîç</span><input id="srch" placeholder="Search products, SKU..." oninput="renderCat()"></div>
        <div class="frow" id="frow"></div>
        <div class="cscroll"><div class="cgrid" id="cgrid"></div></div>
      </div>

      <!-- SKU -->
      <div id="tp-barcode" class="tp">
        <div class="sku-row">
          <div class="field"><label>SKU / Barcode</label><input id="skuIn" placeholder="Type or scan..." onkeydown="if(event.key==='Enter')addSku()"></div>
          <div class="field"><label>Qty</label><input id="skuQty" type="number" value="1" min="1"></div>
          <div class="field" style="justify-content:flex-end;"><button class="btn" onclick="addSku()">Add ‚Üí</button></div>
        </div>
      </div>

      <!-- History -->
      <div id="tp-history" class="tp">
        <div style="overflow-y:auto;max-height:280px;">
          <table class="ht"><thead><tr>
            <th>Invoice</th><th>Customer</th><th>Date</th><th>Items</th><th>Total</th><th>Status</th>
          </tr></thead><tbody id="histTbody"></tbody></table>
        </div>
      </div>
    </div>

    <!-- Cart -->
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:.55rem;">
        <div class="slabel" style="margin:0;">Cart Items</div>
        <button class="btn btn-g btn-sm" onclick="clearCart()">Clear All</button>
      </div>
      <div class="cartscroll" id="cartEl">
        <div class="empty"><div style="font-size:1.6rem;margin-bottom:.4rem;opacity:.4;">üõí</div>Tap any product to add</div>
      </div>
    </div>

  </div>

  <!-- ‚ïê‚ïê RIGHT ‚ïê‚ïê -->
  <div class="rp">

    <!-- Hidden elements kept for JS compatibility -->
    <div style="display:none;">
      <span id="dInv"></span>
      <span id="dDate"></span>
      <span id="dCust"></span>
      <span id="dPhone"></span>
    </div>

    <!-- Customer -->
    <div class="card" style="position:relative;padding:1rem 1.1rem;">
      <div class="cust-header-row" style="margin-bottom:.6rem;">
        <div class="slabel" style="font-size:.82rem;margin:0;">Customer</div>
        <span class="cust-count-badge" id="custCountBadge" style="font-size:.72rem;">0 saved</span>
      </div>
      <div style="display:flex;flex-direction:column;gap:.6rem;">
        <div class="field" style="position:relative;gap:.28rem;">
          <label style="font-size:.78rem;">Name</label>
          <div class="cust-search-wrap">
            <input id="cName" type="text" placeholder="Walk-in or search saved..." oninput="onCustNameInput()" autocomplete="off" style="font-size:1rem;padding:.52rem .9rem;">
            <button class="cust-save-btn" onclick="saveCustomer()" title="Save customer" style="font-size:.76rem;padding:.28rem .6rem;">+ Save</button>
          </div>
          <div class="cust-dropdown" id="custDropdown"></div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:.55rem;">
          <div class="field" style="gap:.28rem;">
            <label style="font-size:.78rem;">Mobile</label>
            <input id="cPhone" type="tel" placeholder="7X XXX XXXX" maxlength="12" oninput="updCust()" style="font-size:1rem;padding:.52rem .9rem;">
          </div>
          <div class="field" style="gap:.28rem;"><label style="font-size:.78rem;">Bill Type</label>
            <select id="bType" onchange="updCust()" style="font-size:1rem;padding:.52rem .9rem;">
              <option>Retail</option><option>Wholesale</option>
              <option>Contractor</option><option>Credit Account</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- Discount -->
    <div class="card">
      <div class="slabel">Discount</div>
      <div class="disc-row">
        <div class="field"><label>Value</label><input id="discV" type="number" value="0" min="0" oninput="calcSummary()"></div>
        <div class="field"><label>Type</label>
          <div class="rg">
            <label class="ro on" id="rPct" onclick="setDT('pct')"><input type="radio" name="dt" checked> %</label>
            <label class="ro" id="rFlat" onclick="setDT('flat')"><input type="radio" name="dt"> ‚Çπ</label>
          </div>
        </div>
        <div class="field" style="justify-content:flex-end;align-items:flex-end;">
          <button class="btn btn-g btn-sm" onclick="document.getElementById('discV').value=0;calcSummary()">Reset</button>
        </div>
      </div>
    </div>

    <!-- Summary -->
    <div class="card">
      <div class="slabel">Summary</div>
      <div class="srows">
        <div class="srow"><span class="slbl">Subtotal</span><span class="sval" id="sub">‚Çπ0.00</span></div>
        <div class="srow"><span class="slbl">Discount</span><span class="sval sval-neg" id="disc">‚àí‚Çπ0.00</span></div>
        <div class="srow"><span class="slbl">GST 18%</span><span class="sval" id="tax">‚Çπ0.00</span></div>
        <div class="hr"></div>
        <div class="srow"><span class="slbl">Items</span><span class="sval sval-dim" id="cnt">0</span></div>
      </div>
    </div>

    <div class="total-card">
      <div class="total-lbl">Total Due</div>
      <div class="total-val" id="tot">‚Çπ0.00</div>
    </div>

    <div class="actions">
      <button class="btn btn-lg" onclick="openPayModal()">‚ö° Checkout</button>
      <div class="bp">
        <button class="btn btn-g" onclick="holdBill()">Hold Bill</button>
        <button class="btn btn-g" onclick="newBill()">New Bill</button>
      </div>
    </div>

  </div>
</main>

<!-- Payment Modal (bottom sheet) -->
<!-- Combined Payment + Receipt Modal -->
<div class="moverlay" id="moverlay" onclick="closeOnBg(event)">
  <div class="modal" style="overflow:hidden;padding:0;display:flex;flex-direction:column;">

    <!-- ‚îÄ‚îÄ PANEL SLIDER ‚îÄ‚îÄ -->
    <div id="modalSlider" style="display:flex;width:200%;transition:transform .38s cubic-bezier(.34,1.1,.64,1);will-change:transform;">

      <!-- ‚îÄ‚îÄ PANEL 1: PAYMENT ‚îÄ‚îÄ -->
      <div style="width:50%;padding:1.8rem;box-sizing:border-box;flex-shrink:0;display:flex;flex-direction:column;gap:.85rem;">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <div class="mtitle" style="margin:0;">üí≥ Payment</div>
          <button class="pay-close-btn" onclick="closeM()">‚úï</button>
        </div>

        <div class="pay-total-row">
          <span class="pay-total-lbl">Total Due</span>
          <span class="pay-total-val" id="payTot">‚Çπ0.00</span>
        </div>

        <div class="pay-methods">
          <div class="ppill on" onclick="setPay(this,'Cash')">üíµ Cash</div>
          <div class="ppill" onclick="setPay(this,'Card')">üí≥ Card</div>
          <div class="ppill" onclick="setPay(this,'UPI')">üì± UPI</div>
          <div class="ppill" onclick="setPay(this,'Credit')">üè¶ Credit</div>
          <div class="ppill" onclick="setPay(this,'Cheque')">üìù Cheque</div>
          <div class="ppill" onclick="setPay(this,'Split')">‚úÇÔ∏è Split</div>
        </div>

        <div class="pay-cash-box show" id="payCashBox">
          <div class="field" style="margin-bottom:.55rem;">
            <label>Amount Tendered</label>
            <input id="tend" type="number" placeholder="0.00" oninput="updChange()" style="font-size:1.1rem;font-weight:800;">
          </div>
          <div class="change-box">
            <span class="clbl">Change Due</span>
            <span class="cval" id="chg">‚Çπ0.00</span>
          </div>
        </div>

        <button class="btn-process" onclick="process()">‚ö° Process &amp; Print Bill</button>
      </div>

      <!-- ‚îÄ‚îÄ PANEL 2: RECEIPT ‚îÄ‚îÄ -->
      <div style="width:50%;padding:1.8rem;box-sizing:border-box;flex-shrink:0;display:flex;flex-direction:column;gap:.75rem;overflow-y:auto;max-height:85vh;">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <div class="mtitle" style="margin:0;">üßæ Receipt</div>
          <button class="pay-close-btn" onclick="closeM()">‚úï</button>
        </div>

        <div id="rcpt"></div>

        <div class="preview-toggle" onclick="toggleImgPreview()">
          <span class="preview-toggle-label"><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg> Preview Invoice Image</span>
          <span class="preview-toggle-arrow" id="previewArrow">‚ñº</span>
        </div>
        <div id="imgPreviewWrap"></div>

        <div class="mactions" style="grid-template-columns:1fr 1fr;gap:.6rem;">
          <button class="btn-print" onclick="doPrint()" title="Print receipt"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg> Print</button>
          <button class="btn-wa-modal" id="btnWA" onclick="sendWhatsAppOnly()"><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg> WhatsApp</button>
        </div>
        <div>
          <button class="btn-combo" id="btnCombo" onclick="printAndSendWhatsApp()" style="width:100%;"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg> Print &nbsp;|&nbsp; <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg> Send</button>
        </div>
        <div>
          <button class="btn btn-g btn-sm" onclick="closeM()" style="width:100%;border-radius:10px;padding:.52rem;">Close</button>
        </div>
      </div>

    </div><!-- /slider -->
  </div>
</div>

<div class="toast" id="toast"></div>

<script src="script.js"></script>
</body>
</html>
